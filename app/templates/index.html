{% extends "base.html" %}
{% block title %}Beranda{% endblock %}
{% block content %}

<div style="display: flex; flex-direction: column; align-items: flex-start; width: 100%; padding-top: 40px;">
    <section class="py-5" style="margin: 0; padding-left: 93px; width: 100%;">
        <a href="#" id="dataLink" style="text-decoration: none;">
            <div id="homeBox" class="boxContainer text-center rounded-3" style="width: 100%; margin: 0; flex-grow: 1;">
                <h1 class="my-5">Upload Data</h1>
            </div>
        </a>
    </section>

    <section style="padding-left: 93px;">
        <div style="width: 100%; display: flex; justify-content: flex-start;">
            <a href="#" id="tahunanLink" style="text-decoration: none;">
                <div id="homeBox" class="boxContainer text-center p-3 p-md-5 rounded-3" style="margin-right: 15px;">
                    <h1 class="my-5">Tahunan</h1>
                </div>
            </a>
            <a href="#" id="bulananLink" style="text-decoration: none;">
                <div id="homeBox" class="boxContainer text-center p-3 p-md-5 rounded-3">
                    <h1 class="my-5">Bulanan</h1>
                </div>
            </a> 
        </div>
    </section>
</div>
<script>
    $(document).ready(function() {
        $('#tahunanLink').on('click', function(e) {
            e.preventDefault();
            Swal.fire({
                title: 'Dashboard Iklim Tahunan',
                html:
                    '<p>Silahkan masukkan tahun awal dan tahun akhir (opsional) untuk melihat iklim tahunan.</p>' +
                    '<div style="margin-bottom: 10px;">' +
                        '<strong>Tahun Awal</strong>' +
                        '<input id="swal-input1" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan tahun">' +
                    '</div>' +
                    '<div>' +
                        '<strong>Tahun Akhir (opsional)</strong>' +
                        '<input id="swal-input2" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan rentang tahun akhir">' +
                    '</div>',
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    const tahunAwal = document.getElementById('swal-input1').value;
                    const tahunAkhir = document.getElementById('swal-input2').value;

                    if (!tahunAwal) {
                        Swal.showValidationMessage('Tahun Awal harus diisi');
                        return false;
                    }

                    if (!/^\d+$/.test(tahunAwal)) {
                        Swal.showValidationMessage('Tahun Awal harus berupa angka');
                        return false;
                    }

                    if (tahunAkhir && !/^\d+$/.test(tahunAkhir)) {
                        Swal.showValidationMessage('Tahun Akhir harus berupa angka');
                        return false;
                    }

                    return [tahunAwal, tahunAkhir];
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const [tahunAwal, tahunAkhir] = result.value;
                    let url = '/tahunan?tahun_awal=' + tahunAwal;
                    if (tahunAkhir) {
                        url += '&tahun_akhir=' + tahunAkhir;
                    }
                    Swal.fire({
                        title: 'Sedang Memproses Data Tahunan...',
                        text: 'Kami sedang mengambil data yang Anda butuhkan. Mohon bersabar, ya! 🧑‍🍳',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    setTimeout(() => {
                        window.location.href = url;
                    }, 1000);
                }
            });
        });
        
        $('#bulananLink').on('click', function(e) {
            e.preventDefault();
            Swal.fire({
                title: 'Dashboard Iklim Bulanan',
                html:
                    '<p>Silahkan masukkan tahun awal, tahun akhir (opsional), bulan awal, dan bulan akhir (opsional) untuk melihat iklim bulanan.</p>' +
                    '<div style="margin-bottom: 10px;">' +
                        '<strong>Tahun Awal</strong>' +
                        '<input id="swal-input1" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan Tahun Awal">' +
                    '</div>' +
                    '<div style="margin-bottom: 10px;">' +
                        '<strong>Tahun Akhir (opsional)</strong>' +
                        '<input id="swal-input2" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan Tahun Akhir">' +
                    '</div>' +
                    '<div style="margin-bottom: 10px;">' +
                        '<strong>Bulan Awal (1-12)</strong>' +
                        '<input id="swal-input3" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan Bulan Awal">' +
                    '</div>' +
                    '<div>' +
                        '<strong>Bulan Akhir (opsional, 1-12)</strong>' +
                        '<input id="swal-input4" class="swal2-input" style="margin-top: 5px;" placeholder="Masukkan Bulan Akhir">' +
                    '</div>',
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Ok',
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    const tahunAwal = document.getElementById('swal-input1').value;
                    const tahunAkhir = document.getElementById('swal-input2').value;
                    const bulanAwal = document.getElementById('swal-input3').value;
                    const bulanAkhir = document.getElementById('swal-input4').value;

                    if (!tahunAwal || !bulanAwal) {
                        Swal.showValidationMessage('Tahun Awal dan Bulan Awal harus diisi');
                        return false;
                    }

                    if (!/^\d+$/.test(tahunAwal) || (tahunAkhir && !/^\d+$/.test(tahunAkhir))) {
                        Swal.showValidationMessage('Tahun harus berupa angka');
                        return false;
                    }

                    if (!/^\d+$/.test(bulanAwal) || (bulanAkhir && !/^\d+$/.test(bulanAkhir))) {
                        Swal.showValidationMessage('Bulan harus berupa angka');
                        return false;
                    }

                    if (bulanAwal < 1 || bulanAwal > 12 || (bulanAkhir && (bulanAkhir < 1 || bulanAkhir > 12))) {
                        Swal.showValidationMessage('Bulan harus di antara 1 dan 12');
                        return false;
                    }

                    return [tahunAwal, tahunAkhir, bulanAwal, bulanAkhir];
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const [tahunAwal, tahunAkhir, bulanAwal, bulanAkhir] = result.value;
                    let url = '/bulanan?tahun_awal=' + tahunAwal + '&bulan_awal=' + bulanAwal;
                    if (tahunAkhir) {
                        url += '&tahun_akhir=' + tahunAkhir;
                    }
                    if (bulanAkhir) {
                        url += '&bulan_akhir=' + bulanAkhir;
                    }

                    Swal.fire({
                        title: 'Sedang Memproses...',
                        text: 'Kami sedang mengambil data bulanan yang Anda pilih. Mohon tunggu sebentar! 🤖',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                        setTimeout(() => {
                        window.location.href = url;
                    }, 1000);
                }
            });
        });
    });
</script>
<script>
    document.getElementById('dataLink').addEventListener('click', function(event) {
        event.preventDefault(); 
        const isLoggedIn = localStorage.getItem('access_token');

        if (!isLoggedIn) {
            Swal.fire({
                title: 'Oops!',
                text: 'Whoaa, kamu perlu login terlebih dahulu!',
                icon: 'warning',
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Baik',
                cancelButtonText: 'Lain kali',
                allowOutsideClick: false,
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/login';
                }
            });
        } else {
            window.location.href = '/'; 
        }
    });
</script>
{% endblock %}